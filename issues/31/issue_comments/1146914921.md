---
author_association: OWNER
created_at: '2022-06-06T00:15:53Z'
html_url: https://github.com/r7kamura/diary/issues/31#issuecomment-1146914921
id: 1146914921
issue_url: https://api.github.com/repos/r7kamura/diary/issues/31
node_id: IC_kwDOHTcevs5EXIhp
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/r7kamura/diary/issues/comments/1146914921/reactions
updated_at: '2022-06-06T00:28:51Z'
url: https://api.github.com/repos/r7kamura/diary/issues/comments/1146914921
user:
  avatar_url: https://avatars.githubusercontent.com/u/111689?v=4
  events_url: https://api.github.com/users/r7kamura/events{/privacy}
  followers_url: https://api.github.com/users/r7kamura/followers
  following_url: https://api.github.com/users/r7kamura/following{/other_user}
  gists_url: https://api.github.com/users/r7kamura/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/r7kamura
  id: 111689
  login: r7kamura
  node_id: MDQ6VXNlcjExMTY4OQ==
  organizations_url: https://api.github.com/users/r7kamura/orgs
  received_events_url: https://api.github.com/users/r7kamura/received_events
  repos_url: https://api.github.com/users/r7kamura/repos
  site_admin: false
  starred_url: https://api.github.com/users/r7kamura/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/r7kamura/subscriptions
  type: User
  url: https://api.github.com/users/r7kamura

---
WSL2のdevcaontainerで `git pull` したら完全に停止して困っていた問題、ホスト側の .bashrc に

```
eval "$(ssh-agent)"
```

を追加したら解決した。これはログイン時にのみ実行すればいいと思うので、多分 .bash_profile で良い。

---

デバッグの過程として、まず

```
ssh -T git@github.com
```

でも再現することを確認し、次に

```
ssh-add -l
```

でも再現することを確認した。この状態で、ホスト側で起動したシェルで適当に

```
eval "$(ssh-agent)"
```

を実行。これ自体では解決はしないのだけど、`ssh-agent` がホスト側で問題無く実行できるということはこれで確かめられる。

その後、冒頭のように .bashrc にこれを記述してから試してみると、問題が解消された。

最初、次のページを見たときは「`git pull` で問題が出る点は似ているが、permission deniedと表示される訳ではないから違うのかも」と思っていたが、解決してから振り返ると、問題としては同じものだったようだ。

- [docker - SSH forwarding using WSL2 and VS code containers on Windows - Stack Overflow](https://stackoverflow.com/questions/67178239/ssh-forwarding-using-wsl2-and-vs-code-containers-on-windows)

> To get VS Code to use your SSH keys from your WSL2 instance inside a Docker container running on the WSL2 backend, you need to tell WSL2 to create an ssh-agent at startup, and add your ssh key to the agent. When VS Code attaches to a container running on the WSL2 backend, it will automatically pick up the running ssh-agent, and allow you to authenticate with your WSL2 SSH keys inside your container.

という情報が明示されていて良かった。

それから、シェルを起動するたびにいちいち `ssh-agent` を起動していは無数に `ssh-agent` が起動してしまうことになるし、何よりそのたびに `ssh-add` を実行しなければいけず、SSH鍵にパスフレーズを付けている場合にこれは非常に手間である。そこで、keychainを導入してシェルスクリプトを生成し、このシェルスクリプトをシェル起動時に読み込ませることにした。

- [WSL2のUbuntuでkeychain経由でssh-agentを使う](https://zenn.dev/kaityo256/articles/ssh_agent_on_wsl)