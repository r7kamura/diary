---
author_association: OWNER
created_at: '2022-06-19T23:49:02Z'
html_url: https://github.com/r7kamura/diary/issues/45#issuecomment-1159834516
id: 1159834516
issue_url: https://api.github.com/repos/r7kamura/diary/issues/45
node_id: IC_kwDOHTcevs5FIauU
performed_via_github_app: 
reactions:
  "+1": 0
  "-1": 0
  confused: 0
  eyes: 0
  heart: 0
  hooray: 0
  laugh: 0
  rocket: 0
  total_count: 0
  url: https://api.github.com/repos/r7kamura/diary/issues/comments/1159834516/reactions
updated_at: '2022-06-20T04:25:35Z'
url: https://api.github.com/repos/r7kamura/diary/issues/comments/1159834516
user:
  avatar_url: https://avatars.githubusercontent.com/u/111689?v=4
  events_url: https://api.github.com/users/r7kamura/events{/privacy}
  followers_url: https://api.github.com/users/r7kamura/followers
  following_url: https://api.github.com/users/r7kamura/following{/other_user}
  gists_url: https://api.github.com/users/r7kamura/gists{/gist_id}
  gravatar_id: ''
  html_url: https://github.com/r7kamura
  id: 111689
  login: r7kamura
  node_id: MDQ6VXNlcjExMTY4OQ==
  organizations_url: https://api.github.com/users/r7kamura/orgs
  received_events_url: https://api.github.com/users/r7kamura/received_events
  repos_url: https://api.github.com/users/r7kamura/repos
  site_admin: false
  starred_url: https://api.github.com/users/r7kamura/starred{/owner}{/repo}
  subscriptions_url: https://api.github.com/users/r7kamura/subscriptions
  type: User
  url: https://api.github.com/users/r7kamura

---
semgrepにPRを出すために、pyenvを入れてpython 3.10.5を入れて……ということをしていた。

この辺を読んでいくと、どうやらsemgrep-cliをいじればいいらしい。

- https://semgrep.dev/docs/contributing/how-to-contribute/
- https://semgrep.dev/docs/contributing/contributing-code/

WSL2でPythonを入れてpipenv installしようとしたらハマってググった。

```
# NG
SEMGREP_SKIP_BIN=true python -m pipenv install --dev

# OK
SEMGREP_SKIP_BIN=true python -m pipenv install --dev --python=/home/r7kamura/.pyenv/shims/python
```

https://github.com/pypa/pipenv/issues/3488 helped me a lot, thanks.

手元でsemgrep-cliを動かすことに成功したが、ドキュメントに書いてある通り、semgrep-coreって実行ファイルがねえよと怒られているので、prebuiltなやつを持ってくるか自分で20分かけてビルドするかして持ってこないといけない。面倒だ……

manual shortcutの項目にある通り、releasesの最新版のtar.gzからsemgrep-coreバイナリを持ってきてPATHの通るところに配置した上で、pipenv shellやら何やらを組み合わせた結果、ようやく手元でインストールしたsemgrepが動いた

![image](https://user-images.githubusercontent.com/111689/174514290-04978a2c-999e-435b-8bf9-784540a89564.png)

一度ローカルでのsemgrepインストール手順を踏むと、コードを変更したときに反映される、つまりコピーしてるのではなく実体を参照するようになるらしい。

```
$ python -m semgrep scan --github-actions
Scanning 2 files with 3 ruby rules.
  100%|██████████████████████████████████████████████████████████████████████████████████████████████████|2/2 tasks
::warning file=semgrep_another_example.rb,line=1,col=1,endLine=1,endCol=6::foo is deprecated. Use baz instead.
::warning file=semgrep_example.rb,line=1,col=1,endLine=1,endCol=6::foo is deprecated. Use baz instead.
::error file=semgrep_example.rb,line=2,col=1,endLine=2,endCol=6::bar is removed. Use baz instead.
::notice file=semgrep_example.rb,line=3,col=1,endLine=3,endCol=6::baz is great.

Some files were skipped or only partially analyzed.
  Scan was limited to files tracked by git.

Ran 3 rules on 2 files: 4 findings.
```

動くようになった。

semgrepにPull Requestを出した。